<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta property="og:type" content="website">
<meta property="og:title" content="zyad86-Hexo">
<meta property="og:url" content="http://zyad86.g  ithub.io/index.html">
<meta property="og:site_name" content="zyad86-Hexo">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="zyad86-Hexo">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://zyad86.g  ithub.io/"/>





  <title>zyad86-Hexo</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">zyad86-Hexo</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">trace of development</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://zyad86.g  ithub.io/2017/07/23/Hadoop-JinYongArena/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ericyz-zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zyad86-Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/07/23/Hadoop-JinYongArena/" itemprop="url">
                  Hadoop-JinYongArena
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-23T17:45:22+08:00">
                2017-07-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="用Hadoop分析金庸人物关系网"><a href="#用Hadoop分析金庸人物关系网" class="headerlink" title="用Hadoop分析金庸人物关系网"></a>用Hadoop分析金庸人物关系网</h1><p>— 用大数据粗略的分析金庸人物关系网</p>
<h2 id="整体结果报告"><a href="#整体结果报告" class="headerlink" title="整体结果报告"></a>整体结果报告</h2><p>达到预期目标并完成了选做内容<br><img src="https://github.com/zyad86/JinYongArena/blob/master/wiki-src/Gephi-OverAll.jpg?raw=true" alt="Gephi-OverAll"></p>
<h3 id="实验目标描述："><a href="#实验目标描述：" class="headerlink" title="实验目标描述："></a>实验目标描述：</h3><blockquote>
<p>金庸的江湖<br>课程设计目标<br>通过一个综合数据分析案例：”金庸的江湖–金庸武侠小说中的任务关系挖掘“，来学习和掌握MapReduce程序设计。通过本课程设计的学习，可以体会如何使用MapReduce完成一个综合性的数据挖掘任务，包括全流程的数据预处理、数据分析、数据后处理等。<br>涉及的编程技能：<br>1.Hadoop中使用第三发JAR包辅助分析<br>2.掌握简单的MapReduce算法设计:<br>   a) 单词同现算法；<br>   b) 数据整理与归一化算法<br>    c) 数据排序（选做）<br>3.掌握带有迭代特性的MapReduce算法设计:<br>    a) PageRank算法<br>    b) 标签传播（Label Propagation）算法（选座）<br>…etc  具体见课程设计要求</p>
</blockquote>
<h2 id="编写环境"><a href="#编写环境" class="headerlink" title="编写环境"></a>编写环境</h2><p>编写环境:        VMware WorkStation 11 Ubuntu  Hadoop 2.7.1 IDEA<br>测试编译环境:    macOS Sierra 10.12.6 IDEA 2017<br>实际运行集群:    南京大学计算机系pasa大数据集群<br>编译依赖包:<br><a href="https://oss.sonatype.org/content/repositories/releases/org/ansj/ansj_seg/" target="_blank" rel="external">ansj_seg-5.1.3.jar</a><br><a href="https://oss.sonatype.org/content/repositories/releases/org/nlpcn/nlp-lang/" target="_blank" rel="external">nlp-lang-1.7.3.jar</a><br><a href="https://mirrors.tuna.tsinghua.edu.cn/apache/hadoop/common/hadoop-2.7.1/" target="_blank" rel="external">hadoop-common-2.7.1.jar</a><br><a href="https://mirrors.tuna.tsinghua.edu.cn/apache/hadoop/common/hadoop-2.7.1/" target="_blank" rel="external">hadoop-dfs-2.7.1.jar</a><br><a href="https://mirrors.tuna.tsinghua.edu.cn/apache/hadoop/common/hadoop-2.7.1/" target="_blank" rel="external">hadoop-mapreduce-client-core-2.7.1.jar</a></p>
<p><img src="https://github.com/zyad86/JinYongArena/blob/master/wiki-src/Jardependence.jpg?raw=true" alt="JarDependence"><br>带依赖打包运行在2.7.1的hadoop集群即可</p>
<h2 id="实验进展流程图："><a href="#实验进展流程图：" class="headerlink" title="实验进展流程图："></a>实验进展流程图：</h2><table>
<thead>
<tr>
<th>Task</th>
<th>Main   </th>
</tr>
</thead>
<tbody>
<tr>
<td>Task1</td>
<td>提取人名，清理无关文本（使用已提供的名字册）</td>
</tr>
<tr>
<td>Task2</td>
<td>人名同现统计</td>
</tr>
<tr>
<td>Task3</td>
<td>人物关系图构建与特征归一化</td>
</tr>
<tr>
<td>Task4</td>
<td>基于人物关系图的PageRank计算</td>
</tr>
<tr>
<td>Task5</td>
<td>数据分析：在人物关系图上的标签传播 并根据结果染色</td>
</tr>
<tr>
<td>Task6</td>
<td>分析结果整理</td>
</tr>
</tbody>
</table>
<h2 id="实现代码模块"><a href="#实现代码模块" class="headerlink" title="实现代码模块"></a>实现代码模块</h2><table>
<thead>
<tr>
<th>Module</th>
<th>Function</th>
</tr>
</thead>
<tbody>
<tr>
<td>数据预处理</td>
<td>Task1-Task3 </td>
</tr>
<tr>
<td>数据处理-PageRank</td>
<td>Task4</td>
</tr>
<tr>
<td>数据处理-LPA</td>
<td>Task5</td>
</tr>
</tbody>
</table>
<h4 id="代码注解："><a href="#代码注解：" class="headerlink" title="代码注解："></a>代码注解：</h4><ol>
<li><p>Txt2name:</p>
<ul>
<li>TransferTask.java: 实现数据与处理方面的mapreduce的job设置，同时将人名列表放入cache中，方便后续的读取。 </li>
<li>TransferMapper.java: 完成自定义词典的配置，进行中文分词操作，提取出其中词性为Name的分词(在自定义词典时，将所有要提取的任务名称的词性均置为Name)，提取出人名同现键对，以此作为reducer函数的输入。其中<value,key>为输出，value为人名，key为与其同现过的人名。</value,key></li>
<li>TransferReducer.java: 以mapper的输出键对作为输入，将同样的键值对进行合并输出类似于&lt;(a,b),time&gt;的键对,以a为主要人物,进行下一步的权重归一化操作，根据不同键值对出现次数的不同，计算权重，将输出格式设为”人名1  人名2：权重2，人名3：权重3……”，各权重值之和为1。</li>
</ul>
</li>
<li><p>PageRank:</p>
<ul>
<li>PageRankDriver.java: 对外接口函数，可通过操作此函数来实现对其余功能的调用，并实现驱动多趟循环的功能</li>
<li>GraphBuilder.java: 该java文件主要进行初始化操作，输入的<key,value>为&lt;文本行号，文本内容&gt;，对之进行处理，赋予初始的pr值输出为key：关系有向图节点人名，value:带pr值的从属人名</key,value></li>
<li>PageRankIter.java: 此java文件包含了pagerank功能函数，，对初始化的pr的值进行迭代工作，参考书上内容后我们设置为迭代次数固定为30次，不对其进行是否收敛的判断以减少工作量。其中mapper函数的输入为上一轮迭代的输出,<key,value>中key为行号，value为每一行的内容，输出<key,value>中，key为人物名，value为更新后的pr值。将mapper的输出传入reducer函数中，输出新一轮迭代后的文件，格式为：”人名1  PR值 人名2:权重2，人名3:权重3,……”。</key,value></key,value></li>
<li>PageRankViewer.java: 主要针对最后一次迭代的结果进行处理，调整其存储结构，只提取&lt;人名，pr值&gt;，将其输出到txt文件中，其中FinalRank中存储最后的PageRank结果。除此之外，在次函数中同时实现了对所有人名pr值的排序工作，将其从大到小一次排序。</li>
</ul>
</li>
<li><p>TagVisual:</p>
<ul>
<li>LPADriver.java: 为对外接口函数，调用此函数可以完成对LPA算法的调用，同时为满足多次迭代操作，在其中设置for循环，实现多趟操作功能。</li>
<li>GraphBuilder.java: 对分词后的输出结果进行处理，将其格式设置为：”人名1 Tag |人名2：权重2：Tag2，人名3：权重3：Tag3，……”，在初始化时每个人物的标签设置为其本身。</li>
<li>LPA.java: 此文件实现了LPA算法，将上一次迭代的输出文件作为下一次的输入文件，根据权重调整人名1的Tag值，并将其传送给与其相关的人物，监督其也调整Tag值。</li>
<li>TagViewer.java: 在LPADriver.java中设置迭代次数为10次,因此TagViewer.java的输入文件为LPA迭代十次后的输出文件。首先自定义一个map存储结构，选取14篇文章中的”主人公”,将其Tag置为1~14后存入map中。对输入文件进行提取工作,(人名，Label)，其中Label值为1~14。此Project主要为可视化操作提供文件输入。</li>
</ul>
</li>
<li><p>Gephi:  </p>
<ul>
<li>针对1模块输出的txt用python处理得到边的csv，通过2，3模块得到的pr和lpa tag处理得到点的csv。导入后稍加调整即可获得所需图像</li>
</ul>
</li>
</ol>
<h2 id="具体模块内实现细节："><a href="#具体模块内实现细节：" class="headerlink" title="具体模块内实现细节："></a>具体模块内实现细节：</h2><ul>
<li>Module1 没什么好说的，借助外部jar还是很好写的</li>
<li>Module2 这部分的pagerank迭代参照书上MapReduce算法部分，结构相同，也没什么好说的，关键就是处理好map和reduce以及定义好处理的数据格式。实现上还需要注意pagerank的溢出和泄露问题，加个判断语句即可。</li>
<li>Module3 这部分debug时间较长细节处会说</li>
</ul>
<h5 id="Module1"><a href="#Module1" class="headerlink" title="Module1:"></a>Module1:</h5><p>就不给出详细描述了，详见作业设计中<br>这里仅仅给出应有的输入输出的图片<br><img src="https://github.com/zyad86/JinYongArena/blob/master/wiki-src/pic/task1.png?raw=true" alt="Task1"><br><img src="https://github.com/zyad86/JinYongArena/blob/master/wiki-src/pic/task2.png?raw=true" alt="Task2"><br><img src="https://github.com/zyad86/JinYongArena/blob/master/wiki-src/pic/task3.png?raw=true" alt="Task3"><br>对于的处理结果可见处理的中间结果</p>
<h5 id="Module2"><a href="#Module2" class="headerlink" title="Module2:"></a>Module2:</h5><p>PageRank算法部分：<br>注意预防Rank Sink和Rank Leak<br>针对这两个问题，我们采取将表达式变为<br>pagerank = (double) (1 - 0.8) + 0.8 * pagerank;这种形式可以避免以上的问题（可以说阻尼系数是0.8） </p>
<ul>
<li>一般来讲这个松弛系数取0.85，PRsum就是不同贡献值的和。最后，做一步清理工作，一是只保留人名和PageRank值，二是利用mapreduce自带的排序，将PageRank值作为主键，得到一个从高到低排序的人名表。<br>数据格式 ：</li>
</ul>
<table>
<thead>
<tr>
<th>状态</th>
<th>数据格式 </th>
</tr>
</thead>
<tbody>
<tr>
<td>Module1执行后的结果</td>
<td>一灯大师    哑梢公:0.00234192037470726,鲁有脚:0.00936768149882904,杨康:0.00702576112412178,耶律燕:0…等 </td>
</tr>
<tr>
<td>PageRank初始化</td>
<td>一灯大师    1.0    哑梢公:0.00234192037470726,鲁有脚:0.00936768149882904,杨康:0.00702576112412178,耶律燕:…等 </td>
</tr>
<tr>
<td>PageRank Mapper 给所有从属节点发出</td>
<td>针对从属节点pagekey，value=weight*pr   </td>
</tr>
<tr>
<td>PageRank Mapper 针对节点本身发出</td>
<td>一灯大师    1.0     \</td>
<td>哑梢公:0.00234192037470726,鲁有脚:0.00936768149882904,杨康:0.00702576112412178,耶律燕:…等</td>
</tr>
<tr>
<td>PageRank Reduce</td>
<td>接受处理以上的同一个key的数据，当遇到直接的节点，权值，通过阻尼系数计算后的pagerank值相加，用于更新这个key的新的pr值，而加上\</td>
<td>标识符号的串作为下一轮开始的初始串。</td>
</tr>
</tbody>
</table>
<p>我们在这里一共迭代了30次（实际上15次基本就稳定了）</p>
<h5 id="Module3"><a href="#Module3" class="headerlink" title="Module3"></a>Module3</h5><p>这个部分本来不应该有什么问题的，实际上却遇到了一个很严重的问题   </p>
<p>这部分的算法基本参照Wayne1234他们的，我认为他们描述的比较好：</p>
<ul>
<li>标签传播（Label Propagation）是一种半监督的图分析算法，他能为图上的顶点打标签，进行图顶点的聚类分析，从而在一张类似社交网络图中完成社区发现（Community Detection）。该任务中，我们用每个聚类的核心人物作为这个类的标签，比如下面输出中，“张无忌”实际上是一个标签名，表示“杨逍”属于张无忌这个类。</li>
<li><p>实现思路： LPA需要迭代，因此我们采用了和PageRank差不多的方式做了初始化，初始化文件的格式如下：</p>
<blockquote>
<p>一灯大师    一灯大师&amp;乔寨主,0.0022988506,乔寨主;华筝,0.0022988506,华筝;……</p>
</blockquote>
</li>
<li><p>这里，“一灯大师”是key，value中，“&amp;”前面的“一灯大师”表示key对应的标签，我们的初始化标签均和自己相同。后面，“乔寨主”是人名，中间数字是它的权重，后一个“乔寨主”是它的标签，在迭代的时候我们会更新这个标签，这里初始化的时候使用的是自己的名字。迭代过程中最关键的是如何选取新的标签，遍历“&amp;”后面的“人名，权值，标签”列表，我们要统计出那个贡献值最高的标签。举例：</p>
</li>
</ul>
<blockquote>
<p>一灯大师    一灯大师&amp;乔寨主,0.0022988506,乔寨主;华筝,0.0022988506,华筝;……</p>
</blockquote>
<ul>
<li>假设我们现在正在统计的就是这一行数据，在解析“&amp;”后面的字符串时，除了第一次迭代之外，会出现多个人对应同一个标签的情况，因此需要一个数组来存储每个标签在当前字符串中的总权值，如果该标签还没出现，那把该标签新家进去，该标签的权值作为总权值的一个初值。比如说现在的这个数组是空的，我发现“乔寨主”的标签是“乔寨主”，那么这个数组里就应该添加一条记录：“乔寨主”这个标签的当前权值是0.00229…，后面还有“乔寨主”的话，直接用那个权值加上当前的“乔寨主”的总权值即可。我们还需要一个数组记录下这整个字符串中的所有人名，这个后面会用到。现在我们已经有了一组“标签，权重”的记录，因此从中挑选权重最高的作为key的标签就可以了，注意输出到reduce的时候，为了保持迭代时文件格式一致，应当将这个长字符串一起发送给reduce。我们还有一件事要做，告诉所有和当前key相关的其他key，当前key对应的标签变了，所以我们输出遍历之前记录了整个字符串中所有人名的数组，以单个人名为key，将更新过的当前的key和标签作为value也输出到reduce以供reduce更新。Reduce过程做的工作就是更新长字符串中的标签，最后按照统一格式写到文件。最后还有一步清理工作，只保留标签和人名输出一个最终文件即可。</li>
</ul>
<h3 id="这个地方的严重BUG"><a href="#这个地方的严重BUG" class="headerlink" title="这个地方的严重BUG"></a>这个地方的严重BUG</h3><p>“有些人走着走着就散了”，在我们第一个版本的LPA迭代，一轮迭代后，1283行剩下了1178行，很多影响力大的人物后面的后缀加起来都没有1，很是奇怪。看了下我们的代码认为实现没有问题</p>
<p>先说说我们定义的数据格式在Map和Reduce阶段的变化：</p>
<ul>
<li>Mapper：  主串  Key  newLabel | lineAfterKey(即原有从属权值信息等)</li>
<li>Mapper：  通知更改串  Keylink &amp; key : newLabel  其中keylink为从属人物 key为主标签 （这里其实有没有更新都会发送更改信息的）</li>
<li>Reduce：  拿下主串，记录下原有从属权值信息</li>
<li>Reduce：  根据通知更改串，更改标签为最新标签</li>
</ul>
<p>详细的执行方式和上面描写的是一致的，而特别的识别符也是&amp;<br>后面DeBug修改的是Reduce阶段的一个策略</p>
<p>初始的策略是：<br>Reduce阶段，首先取最长的那个基础串，记录下他们的权值（用hash记录）（因为另一种更新串的数据格式是 [ key &amp; 原有key 已更改的新标签] 采取的被动更新，就是遍历reduce发过来的所有串，解析到&amp;就更新一个新的子节点加进去。<br>结果就是有的人走着走着就散了，几次迭代过后就没数据了。</p>
<p>后期修改的策略：<br>Reduce阶段，首先取最长的那个基础串，记录下他们的权值（用hash记录）（因为另一种更新串的数据格式是 [ key &amp; 原有key 已更改的新标签] 采取的主动更新，遍历主串的从属串，从解析到&amp;的字符串中更新标签。这样就保证了一个都不会少</p>
<p>现在能确保得到结果可是任然不知道初始策略错在了哪里<br><strong>这边的问题其实到现在还没想清楚，知道为什么的麻烦在issue中告知</strong></p>
<h4 id="Gephi部分的处理"><a href="#Gephi部分的处理" class="headerlink" title="Gephi部分的处理"></a>Gephi部分的处理</h4><p>起初在lpa标签传播阶段没有分类的，只是把最后每个人对应的标签打印处理，通过一个简单的python程序统计下一共多少种，之后给它分类到各个作品里，再写一个函数重新跑一标签使自动对应作品标号  </p>
<p>Gephi需要的边和点的数据也不是很困难，通过python可以轻松的处理，关键是Gephi显示的数据有些迷，之前有几次一直把标签当做了主要的区别符号输出，导致了一大片一大片的标签名散在上面。后来调整里几下就好了</p>
<h2 id="实验结果"><a href="#实验结果" class="headerlink" title="实验结果"></a>实验结果</h2><p>Gephi总体结果:<br><img src="https://github.com/zyad86/JinYongArena/blob/master/wiki-src/Gephi-allFigure.jpg?raw=true" alt="GephiAll"></p>
<p>更换参数获得的新聚类图: 说明我们的标签传播算法还是准确的<br><img src="https://github.com/zyad86/JinYongArena/blob/master/wiki-src/Gephi-AnotherOverall.jpg?raw=true" alt="Gephi-AnotherOverall"></p>
<p>主要角色：<br><img src="https://github.com/zyad86/JinYongArena/blob/master/wiki-src/Gephi-MainChara.jpg?raw=true" alt="Gephi-MainChara"></p>
<p>一些局部图 鹿鼎记<br><img src="https://github.com/zyad86/JinYongArena/blob/master/wiki-src/Gephi-Ludingji.jpg?raw=true" alt="Gephi-Ludingji"></p>
<p>神雕侠侣<br><img src="https://github.com/zyad86/JinYongArena/blob/master/wiki-src/Gephi-Shediao.jpg?raw=true" alt="Gephi-Shediao"></p>
<p>神雕侠侣和射雕英雄传的交界处<br><img src="https://github.com/zyad86/JinYongArena/blob/master/wiki-src/Gephi-ShediaoJiaoShendiao.jpg?raw=true" alt="Gephi-ShediaoJiaoShendiao"></p>
<p>图中一些连接处  这边可以看出没有了其实应该占比较高的说不得什么的，因为在模块一中考虑了这一点特殊处理了一些只在某些作品中有意义的人物名<br><img src="https://github.com/zyad86/JinYongArena/blob/master/wiki-src/Gephi-Connector.jpg?raw=true" alt="Gephi-Connector.jpg"></p>
<p>更多细节可以参见Gephi文件夹中的gephi文件</p>
<h3 id="优化与总结"><a href="#优化与总结" class="headerlink" title="优化与总结"></a>优化与总结</h3><ol>
<li>在分词部分，主要时间花在了外部依赖jar包的调整上，由于没有找到助教推荐的版本，采用了最新的版本，但在最新版本中，ansj_seg的函数接口与原版的略有不同。从最后的分词结果来看，可以认为此次实验中的分词工作基本完成，对人物权重进行归一化处理后，文件结构较为清晰，为之后的功能提供了一个较好的输入。</li>
<li>起初在人物中没有删除说不得等可变成常用语句的角色名，导致大汉、汉子、说不得这类词本来在某部作品中的人物可能到处出现，后来发现还有“农妇”，“胖妇人”“哑巴这种”，妥善的处理方式我认为是在之前加上作品前缀，就不会有滑稽的相关联了，因为这种角色名不可能是连着几部作品的。 </li>
<li>LPA标签传播部分遇到过一个很大的问题，错误处在第一次迭代上，初始化结束之后，第一轮迭代结果人物剩下了1180几个，而原来1283个，真的是“有些人走着走着就散了”，肯定是reduce出了问题，当时的策略是：map阶段，更新节点标签，同时产生一个通知所有相关节点的数据，在reduce阶段，遍历通知节点添加后缀产生新的字符串。这是一个被动的方式，到了凌晨3点多想到了解决方法，主动更新，也就是我们记录下所有的后缀，遍历后缀匹配，强制更新每个后缀的标签吗，这样果然就没有人散了。</li>
<li>大数据集群的运行状态资源分布有时候也会影响运行结果，举个例子，15号凌晨的时候有两个小组和我们一起跑，结果那次运行跑挂了，我们认为是代码问题，改了半天没发现错误，再次跑一遍就是正确的。</li>
<li>本次的结果优化，由于做实验起初就看到了比较好的方案，所以也没自己优化，要是编个起初怎么样，后期怎么样也没意思。集群的性能还是很强大的，我们的程序只有map和reduce，如果进一步优化其实可以再谢谢partition之类的？不过不影响最后结果。</li>
</ol>
<h3 id="Contributer"><a href="#Contributer" class="headerlink" title="Contributer:"></a>Contributer:</h3><table>
<thead>
<tr>
<th>ID</th>
<th>Task       </th>
</tr>
</thead>
<tbody>
<tr>
<td>Ericyz</td>
<td>组长，主要完成LPA部分Debug，数据可视化处理，实验报告总结，Github编写Wiki。 </td>
</tr>
<tr>
<td>你爱上的我</td>
<td>主要完成PageRank–MapReduce算法设计，LPA-MapReduce算法设计。  </td>
</tr>
<tr>
<td>MissAngel</td>
<td>主要完成小说中文分词功能，LPA部分Debug，实验报告撰写。  </td>
</tr>
<tr>
<td>福克斯四世</td>
<td>主要完成小说中文分词功能，实验报告完善，jar包编译调试。</td>
</tr>
</tbody>
</table>
<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference:"></a>Reference:</h3><blockquote>
<p><a href="https://github.com/Wayne1234/Jinyong-Novels-Analysis" target="_blank" rel="external">金庸的江湖，人物关系分析   Jinyong-Novels-Analysis -Wayne1234  标签算法部分描述很好</a><br><a href="https://github.com/sunfvrise/MapReduce-JinYongsWorld" target="_blank" rel="external">基于15本金庸小说的人物关系图挖掘  MapReduce-JinYongsWorld  -sunfvrise 代码框架结构很好 分成三个模块</a><br>《深入理解大数据》机械工业出版社，黄宜华，苗凯翔<br><a href="http://www.cnphp6.com/archives/24136" target="_blank" rel="external">PIG标签传播算法和超级英雄们的社区发现</a></p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://zyad86.g  ithub.io/2017/07/22/YetAnotherDownloadingMethod/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ericyz-zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zyad86-Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/07/22/YetAnotherDownloadingMethod/" itemprop="url">
                  YetAnotherDownloadingMethod
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-22T16:36:47+08:00">
                2017-07-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="一些造好的轮子"><a href="#一些造好的轮子" class="headerlink" title="一些造好的轮子"></a>一些造好的轮子</h1><p>科技改变生活</p>
<p>几个很好用的工具推荐及一些基本的使用方法：</p>
<h2 id="YOU-GET"><a href="#YOU-GET" class="headerlink" title="YOU-GET"></a>YOU-GET</h2><p><a href="https://github.com/soimort/you-get" target="_blank" rel="external">You-Get</a>是一个基于Python3的下载工具。使用You-Get可以很轻松的下载网上的视频，图片，音乐。</p>
<blockquote>
<p>项目主页：<a href="https://github.com/soimort/you-get" target="_blank" rel="external">https://github.com/soimort/you-get</a><br>You-Get 主页：<a href="https://you-get.org/" target="_blank" rel="external">https://you-get.org/</a><br>You-Get 原版中文说明：<a href="https://github.com/soimort/you-get/wiki/中文说明/" target="_blank" rel="external">https://github.com/soimort/you-get/wiki/中文说明/</a><br>作者：<a href="https://github.com/soimort" target="_blank" rel="external">soimort</a></p>
</blockquote>
<p>需要的环境：</p>
<pre><code>Python3  推荐Python3.5.1
pip install you-get
Or pip3 install you-get    
</code></pre><p>&gt;<br>Python的安装方式：<a href="https://www.python.org/downloads/" target="_blank" rel="external">官网</a><br>相关bilibili分p整合下载的脚本：<a href="https://gist.github.com/Sg4Dylan/94565e6629792264ba0b22ff707e088c" target="_blank" rel="external">GayHub链接</a></p>
<p>命令行输入you-get 测试是否安装成功</p>
<p>You-Get 最基本的使用方法 直接是命令 you-get  url<br>若是要使用上述脚本  you-get xx.py url num<br>其中xx.py 为自行命名内容为<a href="https://gist.github.com/Sg4Dylan/94565e6629792264ba0b22ff707e088c" target="_blank" rel="external">GayHub链接</a>的脚本内容，num为BiliBili链接的分P数</p>
<p>这个我主要用来下载国内网站的视频，比如b站，配合一些已有人写好的脚本，下一些分p的视频很是方便，想下很多视频的时候也可以自己写个小的脚本保存某个收藏夹然后批量下载</p>
<h4 id="还是很好用的"><a href="#还是很好用的" class="headerlink" title="还是很好用的"></a>还是很好用的</h4><h2 id="Youtube-dl"><a href="#Youtube-dl" class="headerlink" title="Youtube-dl"></a>Youtube-dl</h2><h3 id="Mac用户直接-brew-install-youtube-dl"><a href="#Mac用户直接-brew-install-youtube-dl" class="headerlink" title="Mac用户直接 brew install youtube-dl"></a>Mac用户直接 brew install youtube-dl</h3><h3 id="FFmpeg也是直接brew-install-ffmpeg-很是方便"><a href="#FFmpeg也是直接brew-install-ffmpeg-很是方便" class="headerlink" title="FFmpeg也是直接brew install ffmpeg 很是方便"></a>FFmpeg也是直接brew install ffmpeg 很是方便</h3><blockquote>
<p>Youtube-dl    ： <a href="http://rg3.github.io/youtube-dl/" target="_blank" rel="external">官方链接</a><br>FFmpeg    : <a href="https://ffmpeg.org" target="_blank" rel="external">官网链接</a></p>
</blockquote>
<p>由于中国局域网的存在可能会安装失败，连接不上，可以加上命令行全局代理（如果你开了ss的话）  </p>
<pre><code>export ALL_PROXY=socks5://127.0.0.1:1080
</code></pre><p>不过这段代码的作用期只是暂时的，不过也足够下载下来软件了</p>
<p>具体的使用方式用的最多的就是：  </p>
<pre><code>youtube-dl URL
youtube-dl -F URL
youtube-dl -f xxx+xxx URL
</code></pre><p>代理开自动，需要加上这么一个参数 </p>
<pre><code>--proxy socks5://127.0.0.1:1080 
</code></pre><p>加在youtube-dl后面<br>所以下载一个视频时最多的时候直接youtube-dl+URL就可以直接下载最高品质的视频源了，如果想下载4k的先-F分析一下，在-f加上视频流和音频流 之后会自动使用ffmpeg合并的。</p>
<p>其他安装方法请参照官网均有说明</p>
<blockquote>
<p>Reference:<br><a href="http://www.jianshu.com/p/a3f8df948395" target="_blank" rel="external">You-Get——基于Python3的媒体下载工具-Login926</a><br><a href="https://lolicon.link/2016/08/07/yet-another-method-to-download-video-from-bilibili/" target="_blank" rel="external">一种批量下载Bilibili视频的方法-SyDylan</a><br>//作者取名的方式很有意思 很像yacc这类啊   </p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://zyad86.g  ithub.io/2017/04/20/lab-redhat-hadoop/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ericyz-zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zyad86-Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/20/lab-redhat-hadoop/" itemprop="url">
                  hadoopRedHatLab2
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-20T10:41:02+08:00">
                2017-04-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>本文中所有x xxx均为未知 须根据你得具体版本号来决定</p>
</blockquote>
<h2 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h2><pre><code>groupadd hadoop_user
useradd -g hadoop_user -d /home/hadoop hadoop
passwd hadoop 
</code></pre><h2 id="配置YUM源"><a href="#配置YUM源" class="headerlink" title="配置YUM源"></a>配置YUM源</h2><p>  Redhat 的更新包只对注册的用户生效，所以我们需要自己手动更改成CentOS的更新包，CentOS几乎和redhat是一样的，所以无需担心软件包是否可安装，安装之后是否有问题。</p>
<p>1、 首先删除redhat原有的yum ，因为redhat 原本的yum 没有注册为redhat用户是用不了的。</p>
<pre><code>rpm -aq|grep yum|xargs rpm -e --nodeps
rpm -aq|grep python-iniparse|xargs rpm -e --nodeps
</code></pre><p>2、下载163的yum 安装包</p>
<pre><code>wget http://mirrors.163.com/centos/7.3.1611/os/x86_64/Packages/
yum-3.4.3-150.el7.centos.noarch.rpm
wget http://mirrors.163.com/centos/7.3.1611/os/x86_64/Packages/
python-iniparse-0.4-9.el7.noarch.rpm
wget http://mirrors.163.com/centos/7.3.1611/os/x86_64/Packages/
yum-metadata-parser-1.1.4-10.el7.x86_64.rpm
wget http://mirrors.163.com/centos/7.3.1611/os/x86_64/Packages/
yum-plugin-fastestmirror-1.1.31-40.el7.noarch.rpm
</code></pre><p>3、安装下载的rpm包</p>
<pre><code>rpm -ivh *.rpm
</code></pre><p>4、创建文件/etc/yum.repos.d/rhel-debuginfo.repo并写入</p>
<pre><code>[base]
name=CentOS-$releasever - Base
baseurl=http://mirrors.163.com/centos/7.3.1611/os/$basearch/
gpgcheck=1
gpgkey=http://mirrors.163.com/centos/7.3.1611/os/x86_64/RPM-GPG-
KEY-CentOS-7


#released updates
[updates]
name=CentOS-$releasever - Updates
baseurl=http://mirrors.163.com/centos/7.3.1611/updates/$basearch/
gpgcheck=1
gpgkey=http://mirrors.163.com/centos/7.3.1611/os/x86_64/RPM-GPG-
KEY-CentOS-7


[extras]
name=CentOS-$releasever - Extras
baseurl=http://mirrors.163.com/centos/7.3.1611/extras//$basearch/
gpgcheck=1
gpgkey=http://mirrors.163.com/centos/7.3.1611/os/x86_64/RPM-GPG-
KEY-CentOS-7

[centosplus]
name=CentOS-$releasever - Plus
baseurl=http://mirrors.163.com/centos/7.3.1611/centosplus//$basearch/
gpgcheck=1
enabled=0
</code></pre><p>6、执行命令</p>
<pre><code>yum clean all
</code></pre><p>7、测试：</p>
<pre><code>yum update
</code></pre><p>8、 安装 epel 源：</p>
<pre><code>yum install epel-release    
</code></pre><h2 id="添加sudoer"><a href="#添加sudoer" class="headerlink" title="添加sudoer"></a>添加sudoer</h2><p>当用户不在sudoers文件中……</p>
<p>处理这个问题很简单，但应该先理解其原理再操作</p>
<p>首先要明白root的密码一般用户是不应改知道的，但一般用户有时可能要用到root的一些权限。</p>
<p>这里就有了一个 /etc/sudoers文件，用来保存一些用户，使这些用户可以通过sudo命令来暂时获取root的权限。这些用户使用sudo时输入的密码是当前用户密码，而不是root密码。还可一在sudoers文件里限制一般用户的权限，这样就有了安全保证。</p>
<p>现在要让hadoop用户获得sudo使用权</p>
<p>1.切换到超级用户root</p>
<pre><code>$su root
</code></pre><p>2.查看/etc/sudoers权限，可以看到当前权限为440</p>
<pre><code>$ ls -all /etc/sudoers
   -r--r----- 1 root root744  6月  8 10:29/etc/sudoers
</code></pre><p>3.更改权限为777</p>
<pre><code>$chmod 777/etc/sudoers
</code></pre><p>4.编辑/etc/sudoers</p>
<pre><code>$vi /etc/sudoers
</code></pre><p>5.在root   ALL=(ALL:ALL) ALL 下面添加一行</p>
<pre><code>hadoop   ALL=(ALL)ALL
</code></pre><p>   保存退出。<br>   第一个ALL是指网络中的主机，我们后面把它改成了主机名，它指明jack可以在此主机上执行后 面的命令。</p>
<p>   第二个括号里的ALL是指目标用户，也就是以谁的身份去执行命令。<br>   最后一个ALL当然就是指命令名了。<br>   具体这里不作说明</p>
<p>6.把/etc/sudoers权限改回440</p>
<pre><code>$chmod 440 /etc/sudoers
</code></pre><p>7.操作完成，切换到hadoop用户测试一下</p>
<h2 id="ssh免密码"><a href="#ssh免密码" class="headerlink" title="ssh免密码"></a>ssh免密码</h2><pre><code>cd ~/.ssh/
ssh-keygen -t rsa  
</code></pre><p>这边一路回车就好</p>
<pre><code>cat ./id_rsa.pub &gt;&gt; ./authorized_keys
</code></pre><p>test:   </p>
<pre><code>ssh localhost 
</code></pre><p>测试一下是否免密码了</p>
<h2 id="jdk环境配置"><a href="#jdk环境配置" class="headerlink" title="jdk环境配置"></a>jdk环境配置</h2><p><a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html" target="_blank" rel="external">Java SE Development Kit 8 Downloads</a></p>
<p>按照实验手册的要求我们将它解压到 root/usr/java这个目录下</p>
<p>那么jdk用户目录是 /usr/java/java-xxx （这边视具体情况自己补全吧，下面同</p>
<h3 id="设置环境变量"><a href="#设置环境变量" class="headerlink" title="设置环境变量"></a>设置环境变量</h3><pre><code>vim ~/.bashrc
</code></pre><p>在文件最后面加入单独一行</p>
<pre><code>export JAVA_HOME=/usr/java/java-xxx
</code></pre><p>使得环境生效</p>
<pre><code>source ~/.bashrc
</code></pre><p>检验配置是否正确：</p>
<pre><code>echo $JAVA_HOME    # 检验变量值
java -version
$JAVA_HOME/bin/java -version   
</code></pre><p>如果与直接执行 java -version 一样则成功</p>
<h2 id="hadoop单机配置"><a href="#hadoop单机配置" class="headerlink" title="hadoop单机配置"></a>hadoop单机配置</h2><p>记得下载binary版本的</p>
<p><a href="http://hadoop.apache.org/releases.html" target="_blank" rel="external">Hadoop</a></p>
<p>下载完一般没问题，如果出现了奇怪的问题强烈建议check下md5码</p>
<pre><code>mkdir ~/hadoop_installs
</code></pre><p>将下载下来的安装包丢到该目录解压</p>
<pre><code>tar -zxvf hadoop-2.7.x.tar.gz
</code></pre><p>测试文件是否完整，因为是编译好的，解压完就能用</p>
<pre><code>cd /home/hadoop_installs/hadoop-2.7.x
./bin/hadoop version
</code></pre><p>若显示版本号 那就正常了</p>
<h2 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h2><p>编辑~/.bashrc</p>
<pre><code>gedit ~/.bashrc
</code></pre><p>添加如下内容： </p>
<pre><code>export HADOOP_HOME=/home/hadoop_installs/hadoop-2.7.x 
export HADOOP_INSTALL=$HADOOP_HOME
export HADOOP_MAPRED_HOME=$HADOOP_HOME
export HADOOP_COMMON_HOME=$HADOOP_HOME
export HADOOP_HDFS_HOME=$HADOOP_HOME
export YARN_HOME=$HADOOP_HOME
export HADOOP_COMMON_LIB_NATIVE_DIR=$HADOOP_HOME/lib/native
export PATH=$PATH:$HADOOP_HOME/sbin:$HADOOP_HOME/bin
</code></pre><p>保存后不要忘了执行以下命令使配置生效</p>
<pre><code>source ~/.bashrc
</code></pre><h3 id="hadoop单机运行"><a href="#hadoop单机运行" class="headerlink" title="hadoop单机运行"></a>hadoop单机运行</h3><p>现在我们可以执行例子来感受下 Hadoop 的运行。Hadoop 附带了丰富的例子（运行 ./bin/hadoop jar ./share/hadoop/mapreduce/hadoop-mapreduce-examples-2.6.0.jar 可以看到所有例子），包括 wordcount、terasort、join、grep 等。</p>
<p>在此选择运行 grep 例子，将 input 文件夹中的所有文件作为输入，筛选当中符合正则表达式 dfs[a-z.]+ 的单词并统计出现的次数，最后输出结果到 output 文件夹中。</p>
<pre><code>cd /usr/local/hadoop
mkdir ./input
cp ./etc/hadoop/*.xml ./input   # 将配置文件作为输入文件
./bin/hadoop jar ./share/hadoop/mapreduce/hadoop-mapreduce-
examples-*.jar grep ./input ./output &apos;dfs[a-z.]+&apos;
cat ./output/*          # 查看运行结果
</code></pre><p>此处提示“WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform… using builtin-java classes where applicable”，该 WARN 提示可以忽略，不会影响 Hadoop 正常运行（可通过编译 Hadoop 源码解决，解决方法请自行搜索）。 源头是binary是在一个32位的机器上编译的。</p>
<p>若出现提示 “INFO metrics.MetricsUtil: Unable to obtain hostName java.net.UnknowHostException”，这需要执行如下命令修改 hosts 文件，为你的主机名增加IP映射：</p>
<pre><code>sudo vim /etc/hosts
</code></pre><p>在最后面增加一行 “127.0.0.1 dblab”</p>
<p>保存文件后重新运行 hadoop 实例，若执行成功的话会输出很多作业的相关信息，最后的输出信息如下图所示。作业的结果会输出在指定的 output 文件夹中，通过命令 cat ./output/* 查看结果，符合正则的单词 dfsadmin 出现了1次</p>
<h5 id="注意，Hadoop-默认不会覆盖结果文件，因此再次运行上面实例会提示出错，需要先将-output-删除。"><a href="#注意，Hadoop-默认不会覆盖结果文件，因此再次运行上面实例会提示出错，需要先将-output-删除。" class="headerlink" title="注意，Hadoop 默认不会覆盖结果文件，因此再次运行上面实例会提示出错，需要先将 ./output 删除。"></a>注意，Hadoop 默认不会覆盖结果文件，因此再次运行上面实例会提示出错，需要先将 ./output 删除。</h5><pre><code>rm -r ./output
</code></pre><p>这边如果遇上运行后不知道java位置的情况，可以将更改配置文件hadoop-env.sh其中直接写详细的java位置即可 不过这不是根本解决方法 还是检查下自己之前的配置</p>
<h3 id="hadoop伪分布配置"><a href="#hadoop伪分布配置" class="headerlink" title="hadoop伪分布配置"></a>hadoop伪分布配置</h3><p>在设置 Hadoop 伪分布式配置前，我们还需要设置 HADOOP 环境变量，执行上面的环境配置即可</p>
<p>Hadoop 的配置文件位于 /usr/local/hadoop/etc/hadoop/ 中，伪分布式需要修改2个配置文件 core-site.xml 和 hdfs-site.xml 。Hadoop的配置文件是 xml 格式，每个配置以声明 property 的 name 和 value 的方式来实现。</p>
<pre><code>gedit ./etc/hadoop/core-site.xml
</code></pre><p>改为:</p>
<pre><code>&lt;configuration&gt;
&lt;property&gt;
    &lt;name&gt;hadoop.tmp.dir&lt;/name&gt;
    &lt;value&gt;file:/usr/local/hadoop/tmp&lt;/value&gt;
    &lt;description&gt;Abase for other temporary directories.&lt;/description&gt;
&lt;/property&gt;
&lt;property&gt;
    &lt;name&gt;fs.defaultFS&lt;/name&gt;
    &lt;value&gt;hdfs://localhost:9000&lt;/value&gt;
&lt;/property&gt;
&lt;/configuration&gt;
</code></pre><p>同样的修改 hdfs-site.xml</p>
<pre><code>gedit ./etc/hadoop/hdfs-site.xml
</code></pre><p>改为</p>
<pre><code>&lt;configuration&gt;
&lt;property&gt;
    &lt;name&gt;dfs.replication&lt;/name&gt;
    &lt;value&gt;1&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
    &lt;name&gt;dfs.namenode.name.dir&lt;/name&gt;
    &lt;value&gt;file:/usr/local/hadoop/tmp/dfs/name&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
    &lt;name&gt;dfs.datanode.data.dir&lt;/name&gt;
    &lt;value&gt;file:/usr/local/hadoop/tmp/dfs/data&lt;/value&gt;
&lt;/property&gt;
&lt;/configuration&gt;
</code></pre><p>配置完成后，执行 NameNode 的格式化:</p>
<pre><code>./bin/hdfs namenode -format
</code></pre><h5 id="其实这里如果之前配置生效可以直接hdfs-namenode-format了"><a href="#其实这里如果之前配置生效可以直接hdfs-namenode-format了" class="headerlink" title="其实这里如果之前配置生效可以直接hdfs namenode -format了"></a>其实这里如果之前配置生效可以直接hdfs namenode -format了</h5><p>成功的话，会看到 “successfully formatted” 和 “Exitting with status 0” 的提示，若为 “Exitting with status 1” 则是出错。</p>
<p>接着开启 NaneNode 和 DataNode 守护进程：</p>
<pre><code>./sbin/start-dfs.sh
</code></pre><p>若出现如下 SSH 的提示 “Are you sure you want to continue connecting”，输入 yes 即可。</p>
<p>启动完成后，可以通过命令 jps 来判断是否成功启动，若成功启动则会列出如下进程: “NameNode”、”DataNode”和SecondaryNameNode（如果 SecondaryNameNode 没有启动，请运行 sbin/stop-dfs.sh 关闭进程，然后再次尝试启动尝试）。如果没有 NameNode 或 DataNode ，那就是配置不成功，请仔细检查之前步骤，或通过查看启动日志排查原因。（具体请参考ref链接）</p>
<p>成功启动后，可以访问 Web 界面 <a href="http://localhost:50070" target="_blank" rel="external">http://localhost:50070</a> 查看 NameNode 和 Datanode 信息，还可以在线查看 HDFS 中的文件。</p>
<h3 id="运行Hadoop伪分布式实例"><a href="#运行Hadoop伪分布式实例" class="headerlink" title="运行Hadoop伪分布式实例"></a>运行Hadoop伪分布式实例</h3><p>上面的单机模式，grep 例子读取的是本地数据，伪分布式读取的则是 HDFS 上的数据。要使用 HDFS，首先需要在 HDFS 中创建用户目录：</p>
<pre><code>./bin/hdfs dfs -mkdir -p /user/hadoop
</code></pre><p>接着将 ./etc/hadoop 中的 xml 文件作为输入文件复制到分布式文件系统中，即将 /usr/local/hadoop/etc/hadoop 复制到分布式文件系统中的 /user/hadoop/input 中。我们使用的是 hadoop 用户，并且已创建相应的用户目录 /user/hadoop ，因此在命令中就可以使用相对路径如 input，其对应的绝对路径就是 /user/hadoop/input:<br>wordcount测试：</p>
<pre><code>./bin/hdfs dfs -mkdir input
./bin/hdfs dfs -put ./etc/hadoop/*.xml input
</code></pre><p>复制完成后，可以通过如下命令查看 HDFS 中的文件列表：</p>
<pre><code>./bin/hdfs dfs -ls input
</code></pre><p>伪分布式运行 MapReduce 作业的方式跟单机模式相同，区别在于伪分布式读取的是HDFS中的文件（可以将单机步骤中创建的本地 input 文件夹，输出结果 output 文件夹都删掉来验证这一点）。</p>
<pre><code>./bin/hadoop jar ./share/hadoop/mapreduce/hadoop-mapreduce- 
examples-*.jar grep input output &apos;dfs[a-z.]+&apos;
</code></pre><p>查看运行结果的命令（查看的是位于 HDFS 中的输出结果）：</p>
<pre><code>./bin/hdfs dfs -cat output/*
</code></pre><p>我们也可以将运行结果取回到本地：</p>
<pre><code>rm -r ./output    # 先删除本地的 output 文件夹（如果存在）

./bin/hdfs dfs -get output ./output     # 将 HDFS 上的 output 文件夹    拷贝到本机
cat ./output/*
</code></pre><p>Hadoop 运行程序时，输出目录不能存在，否则会提示错误 “org.apache.hadoop.mapred.FileAlreadyExistsException: Output directory hdfs://localhost:9000/user/hadoop/output already exists” ，因此若要再次执行，需要执行如下命令删除 output 文件夹:</p>
<pre><code>./bin/hdfs dfs -rm -r output    # 删除 output 文件夹
</code></pre><p>若要关闭Hadoop,则运行：</p>
<pre><code>./sbin/stop-dfs.sh
</code></pre><blockquote>
<p>下次启动 hadoop 时，无需进行 NameNode 的初始化，只需要运行 ./sbin/start-dfs.sh 就可以！</p>
<p>若要运行wordcount 直接 (前提你建好文件夹用上述方法传文件进去 同样 output运行前不能存在</p>
</blockquote>
<pre><code>hadoop jar ./share/hadoop/mapreduce/hadoop-mapreduce-examples-2.7.1.jar wordcount /input /output    
</code></pre><h2 id="启动YARN"><a href="#启动YARN" class="headerlink" title="启动YARN"></a>启动YARN</h2><p>伪分布式不启动 YARN 也可以，一般不会影响程序执行）<br>YARN 是从 MapReduce 中分离出来的，负责资源管理与任务调度。YARN 运行于 MapReduce 之上，提供了高可用性、高扩展性，YARN 的更多介绍在此不展开，有兴趣的可查阅相关资料。</p>
<p>上述通过 ./sbin/start-dfs.sh 启动 Hadoop，仅仅是启动了 MapReduce 环境，我们可以启动 YARN ，让 YARN 来负责资源管理与任务调度。</p>
<p>首先修改配置文件 mapred-site.xml，这边需要先进行重命名</p>
<pre><code>mv ./etc/hadoop/mapred-site.xml.template ./etc/hadoop/mapred-site.xml
</code></pre><p>将其配置修改为:</p>
<pre><code>&lt;configuration&gt;
    &lt;property&gt;
        &lt;name&gt;mapreduce.framework.name&lt;/name&gt;
         &lt;value&gt;yarn&lt;/value&gt;
      &lt;/property&gt;
&lt;/configuration&gt;
</code></pre><p>接着修改配置文件 yarn-site.xml：</p>
<pre><code>&lt;configuration&gt;
    &lt;property&gt;
        &lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt;
        &lt;value&gt;mapreduce_shuffle&lt;/value&gt;
    &lt;/property&gt;
&lt;/configuration&gt;
</code></pre><p>然后就可以开启yarn了：</p>
<pre><code>./sbin/start-yarn.sh      $ 启动YARN
./sbin/mr-jobhistory-daemon.sh start historyserver  # 开启历史服务器，才能在Web中查看任务运行情况
</code></pre><p>开启后通过 jps 查看，可以看到多了 NodeManager 和 ResourceManager 两个后台进程。</p>
<p>启动 YARN 之后，运行实例的方法还是一样的，仅仅是资源管理方式、任务调度不同。观察日志信息可以发现，不启用 YARN 时，是 “mapred.LocalJobRunner” 在跑任务，启用 YARN 之后，是 “mapred.YARNRunner” 在跑任务。启动 YARN 有个好处是可以通过 Web 界面查看任务的运行情况：<a href="http://localhost:8088/cluster" target="_blank" rel="external">http://localhost:8088/cluster</a></p>
<p>但 YARN 主要是为集群提供更好的资源管理与任务调度，然而这在单机上体现不出价值，反而会使程序跑得稍慢些。因此在单机上是否开启 YARN 就看实际情况了。</p>
<blockquote>
<p>不启动 YARN 需重命名 mapred-site.xml<br>如果不想启动 YARN，务必把配置文件 mapred-site.xml 重命名，改成mapred-site.xml.template，需要用时改回来就行。否则在该配置文件存在，而未开启 YARN 的情况下，运行程序会提示 “Retrying connect to server: 0.0.0.0/0.0.0.0:8032” 的错误，这也是为何该配置文件初始文件名为 mapred-site.xml.template。</p>
</blockquote>
<p>同样的，关闭 YARN 的脚本如下：</p>
<pre><code>./sbin/stop-yarn.sh
./sbin/mr-jobhistory-daemon.sh stop historyserver
</code></pre><blockquote>
<h1 id="Referene"><a href="#Referene" class="headerlink" title="Referene:"></a>Referene:</h1><p> <a href="http://www.powerxing.com/install-hadoop-in-centos/" target="_blank" rel="external">Hadoop安装教程_单机/伪分布式配置_CentOS6.4/Hadoop2.6.0</a><br><a href="http://blog.chinaunix.net/uid-28311809-id-4383551.html" target="_blank" rel="external">Yarn简单介绍及内存配置</a><br><a href="http://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-common/SingleCluster.html" target="_blank" rel="external">Hadoop: Setting up a Single Node Cluster.</a><br><a href="https://tecadmin.net/setup-hadoop-single-node-cluster-on-centos-redhat/" target="_blank" rel="external">How to Setup Hadoop 2.8 on CentOS, Ubuntu and LinuxMint</a></p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://zyad86.g  ithub.io/2017/04/18/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ericyz-zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zyad86-Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/18/hello-world/" itemprop="url">
                  Hello World
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-18T15:02:11+08:00">
                2017-04-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.png"
               alt="ericyz-zhang" />
          <p class="site-author-name" itemprop="name">ericyz-zhang</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">标签</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ericyz-zhang</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  




	





  





  





  






  





  

  

  

  

  

</body>
</html>
